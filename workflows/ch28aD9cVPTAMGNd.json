{"updatedAt":"2026-02-13T15:32:30.000Z","createdAt":"2026-02-11T07:00:51.288Z","id":"ch28aD9cVPTAMGNd","name":"My workflow 2","description":null,"active":false,"isArchived":true,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-368,96],"id":"d80c5f98-02c7-4d6b-9557-b1a6edc6f60d","name":"When clicking â€˜Execute workflowâ€™"},{"parameters":{"method":"POST","url":"https://platform-api.max.ru/messages","sendQuery":true,"queryParameters":{"parameters":[{"name":"chat_id","value":"-70960394824245"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"f9LHodD0cOIrOKvR8Ce9CO249up2b9d1pJ-iF5OieiU3so5i0yTfmAmFw8WdhlFAykn4WfHG7XQHUBuUb6Iq"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{$json}}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1504,208],"id":"a42af0ef-b370-4343-985b-a479cd3cbc8b","name":"Send Message1"},{"parameters":{"method":"POST","url":"https://platform-api.max.ru/uploads","sendQuery":true,"queryParameters":{"parameters":[{"name":"type","value":"image"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"f9LHodD0cOIrOKvR8Ce9CO249up2b9d1pJ-iF5OieiU3so5i0yTfmAmFw8WdhlFAykn4WfHG7XQHUBuUb6Iq"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[464,64],"id":"8a873dab-fff4-4e88-873c-0db100f89f8e","name":"Ð£Ð·ÐµÐ» A1","retryOnFail":true,"maxTries":5,"waitBetweenTries":2000},{"parameters":{"method":"POST","url":"={{ $('Ð£Ð·ÐµÐ» A1').item.json.url }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Expect"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"data","inputDataFieldName":"data"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[976,224],"id":"af3cac0c-76b1-4e58-aa60-7f655d4210bd","name":"Ð£Ð·ÐµÐ» C1"},{"parameters":{"url":"={{ $json.url }}\n","options":{"redirect":{"redirect":{}},"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[480,352],"id":"361906c5-711e-4a28-bca3-e8f6387cd39c","name":"Ð£Ð·ÐµÐ» B1"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[752,224],"id":"ec330aa6-e5d8-421f-a202-8c6248ff8509","name":"Merge1","onError":"continueRegularOutput"},{"parameters":{"jsCode":"const text = `https://storage.mwsapis.ru/auto-post/%D0%9D%D0%9E%D0%92%D0%9E%D0%A1%D0%98%D0%91%D0%98%D0%A0%D0%A1%D0%9A/%D0%A7%D0%B5%D1%87%D0%B5%D1%82%D0%BA%D0%B0/107%20%D0%BC%D1%80%D0%B0%D0%BC%D0%BE%D1%80%D0%BD%D0%B0%D1%8F%20%D0%B3%D0%BE%D0%B2%D1%8F%D0%B4%D0%B8%D0%BD%D0%B0/%D0%B0%D0%BD%D1%82%D1%80%D0%B5%D0%BA%D0%BE%D1%82%20%D0%B8%20%D0%BB%D0%BE%D0%BF%D0%B0%D1%82%D0%BA%D0%B0.jpg\nhttps://storage.mwsapis.ru/auto-post/%D0%9D%D0%9E%D0%92%D0%9E%D0%A1%D0%98%D0%91%D0%98%D0%A0%D0%A1%D0%9A/%D0%A7%D0%B5%D1%87%D0%B5%D1%82%D0%BA%D0%B0/107%20%D0%BC%D1%80%D0%B0%D0%BC%D0%BE%D1%80%D0%BD%D0%B0%D1%8F%20%D0%B3%D0%BE%D0%B2%D1%8F%D0%B4%D0%B8%D0%BD%D0%B0/%D0%B3%D1%80%D1%83%D0%B4%D0%B8%D0%BD%D0%BA%D0%B0.jpg\nhttps://storage.mwsapis.ru/auto-post/%D0%9D%D0%9E%D0%92%D0%9E%D0%A1%D0%98%D0%91%D0%98%D0%A0%D0%A1%D0%9A/%D0%A7%D0%B5%D1%87%D0%B5%D1%82%D0%BA%D0%B0/107%20%D0%BC%D1%80%D0%B0%D0%BC%D0%BE%D1%80%D0%BD%D0%B0%D1%8F%20%D0%B3%D0%BE%D0%B2%D1%8F%D0%B4%D0%B8%D0%BD%D0%B0/%D0%B4%D1%8B%D0%B5%20%D0%BC%D1%8F%D0%BA%D0%BE%D1%82%D0%B8.jpg`;\n\nconst urls = text\n  .split(/\\r?\\n/)\n  .map(s => s.trim())\n  .filter(Boolean);\n\nreturn urls.map(url => ({ json: { url } }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[48,160],"id":"ce542c23-1f4c-4123-a309-d1875e5241cc","name":"Code in JavaScript"},{"parameters":{"jsCode":"const items = $input.all();\n\n// ÑÐ¾Ð±Ñ€Ð°Ð»Ð¸ Ñ‚Ð¾ÐºÐµÐ½Ñ‹ ÐºÐ°Ñ€Ñ‚Ð¸Ð½Ð¾Ðº Ð¸Ð· it.json.photos\nconst tokens = [];\n\nfor (const it of items) {\n  const photos = it.json.photos;\n  if (!photos) continue;\n\n  for (const v of Object.values(photos)) {\n    if (v?.token) tokens.push(v.token);\n  }\n}\n\nreturn [{\n  json: {\n    text: \"ÐžÑ‚Ñ‡Ñ‘Ñ‚ Ð·Ð° Ð´ÐµÐ½ÑŒ ðŸ“¦\",\n    format: \"markdown\",\n    notify: true,\n    attachments: [\n      ...tokens.map(t => ({\n        type: \"image\",\n        payload: { token: t }\n      })),\n\n      // âœ… ÐºÐ½Ð¾Ð¿ÐºÐ¸ ÐºÐ°Ðº inline_keyboard\n      {\n        type: \"inline_keyboard\",\n        payload: {\n          buttons: [\n            [{ type: \"link\", text: \"ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³\", url: \"https://koptorg.ru:7026\" }],\n            [{ type: \"link\", text: \"Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·\", url: \"https://koptorg.ru:7026\" }],\n          ]\n        }\n      }\n    ]\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1184,224],"id":"9e1cbbce-5d63-4f19-9072-716e3209a48a","name":"Code in JavaScript1"},{"parameters":{"method":"POST","url":"https://platform-api.max.ru/messages","sendQuery":true,"queryParameters":{"parameters":[{"name":"chat_id","value":"-70960394824245"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"f9LHodD0cOIrOKvR8Ce9CO249up2b9d1pJ-iF5OieiU3so5i0yTfmAmFw8WdhlFAykn4WfHG7XQHUBuUb6Iq"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{$json}}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1344,704],"id":"17a89a83-e8f1-4471-bf8e-78a93553fa76","name":"Send Message"},{"parameters":{"method":"POST","url":"https://platform-api.max.ru/uploads","sendQuery":true,"queryParameters":{"parameters":[{"name":"type","value":"={{$json.uploadType}}\n\n"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"f9LHodD0cOIrOKvR8Ce9CO249up2b9d1pJ-iF5OieiU3so5i0yTfmAmFw8WdhlFAykn4WfHG7XQHUBuUb6Iq"}]},"options":{"response":{"response":{"responseFormat":"json"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[304,560],"id":"0149d488-2805-46f2-a2df-e3837f5b50e9","name":"Ð£Ð·ÐµÐ» A","retryOnFail":true,"maxTries":5,"waitBetweenTries":2000},{"parameters":{"method":"POST","url":"={{ $('Ð£Ð·ÐµÐ» A').item.json.url }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Expect"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"parameterType":"formBinaryData","name":"data","inputDataFieldName":"data"}]},"options":{"response":{"response":{"responseFormat":"text"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[816,720],"id":"8dfbc0f7-1e8c-43e5-973d-4154999cffb3","name":"Ð£Ð·ÐµÐ» C"},{"parameters":{"url":"={{ $json.url }}\n","options":{"redirect":{"redirect":{}},"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[320,848],"id":"3677d3ee-bb6b-4cb2-b869-6ce90ccc2a0c","name":"Ð£Ð·ÐµÐ» B"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[592,720],"id":"d2dc2fdb-1914-4986-b52f-928ae9541fa7","name":"Merge","onError":"continueRegularOutput"},{"parameters":{"jsCode":"const text = `https://storage.mwsapis.ru/auto-post/%D0%9D%D0%9E%D0%92%D0%9E%D0%A1%D0%98%D0%91%D0%98%D0%A0%D0%A1%D0%9A/%D0%A2%D1%80%D0%B5%D1%82%D1%8C%D1%8F%D0%BA%D0%BE%D0%B2%D0%B0%20%D0%BC%D1%8F%D1%81%D0%BE/117%20%D1%85%D0%BE%D0%BB%D0%BE%D0%B4%D0%B5%D1%86/3%20%D1%85%D0%BE%D0%BB%D0%BE%D0%B4%D0%B5%D1%86%20%D0%B2%D0%B1%D0%BB%D0%B8%D0%B7%D0%B8%202.jpg\nhttps://storage.mwsapis.ru/auto-post/%D0%9D%D0%9E%D0%92%D0%9E%D0%A1%D0%98%D0%91%D0%98%D0%A0%D0%A1%D0%9A/%D0%A2%D1%80%D0%B5%D1%82%D1%8C%D1%8F%D0%BA%D0%BE%D0%B2%D0%B0%20%D0%BC%D1%8F%D1%81%D0%BE/117%20%D1%85%D0%BE%D0%BB%D0%BE%D0%B4%D0%B5%D1%86/4%20%D0%BE%D1%82%D0%B7%D1%8B%D0%B2%D1%8B.jpg\nhttps://storage.mwsapis.ru/auto-post/%D0%9D%D0%9E%D0%92%D0%9E%D0%A1%D0%98%D0%91%D0%98%D0%A0%D0%A1%D0%9A/%D0%A2%D1%80%D0%B5%D1%82%D1%8C%D1%8F%D0%BA%D0%BE%D0%B2%D0%B0%20%D0%BC%D1%8F%D1%81%D0%BE/117%20%D1%85%D0%BE%D0%BB%D0%BE%D0%B4%D0%B5%D1%86/5%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%D1%85%D0%BE%D0%BB%D0%BE%D0%B4%D0%B5%D1%86.mp4`;\n\nconst urls = text.split(/\\r?\\n/).map(s => s.trim()).filter(Boolean);\n\nfunction detectType(url) {\n  const u = url.toLowerCase();\n  if (u.endsWith('.mp4') || u.endsWith('.mov') || u.endsWith('.webm')) return 'video';\n  if (u.endsWith('.mp3') || u.endsWith('.wav') || u.endsWith('.ogg')) return 'audio';\n  return 'image';\n}\n\nreturn urls.map(url => ({\n  json: {\n    url,\n    uploadType: detectType(url),          // <-- Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð¹Ð´Ñ‘Ñ‚ Ð² /uploads?type=\n    attachmentType: detectType(url),      // <-- Ñ‚Ð¾, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð¹Ð´Ñ‘Ñ‚ Ð² attachments[].type\n  }\n}));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-112,656],"id":"d46f6550-6bde-44fe-aa77-6f12fb98d7a3","name":"Code in JavaScript2"},{"parameters":{"jsCode":"const items = $input.all();\n\nfunction getUploadType(it) {\n  return (it.json.attachmentType || it.json.uploadType || '').toLowerCase();\n}\n\nfunction extractToken(it) {\n  // Ð’Ð˜Ð”Ð•Ðž/ÐÐ£Ð”Ð˜Ðž: Ñ‚Ð¾ÐºÐµÐ½ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¸Ð· /uploads (ÑƒÐ·ÐµÐ» A)\n  // Ð¿Ð¾ÑÐ»Ðµ Merge Ð¾Ð½ Ñ‡Ð°ÑÑ‚Ð¾ Ð»ÐµÐ¶Ð¸Ñ‚ Ð¿Ñ€ÑÐ¼Ð¾ Ð² it.json.token\n  if (it.json.token) return it.json.token;\n\n  // ÐšÐÐ Ð¢Ð˜ÐÐšÐ˜: Ñ‚Ð¾ÐºÐµÐ½ Ñ‡Ð°ÑÑ‚Ð¾ Ð»ÐµÐ¶Ð¸Ñ‚ Ð² it.json.photos (ÐºÐ°Ðº Ñƒ Ñ‚ÐµÐ±Ñ Ð±Ñ‹Ð»Ð¾)\n  if (it.json.photos) {\n    for (const v of Object.values(it.json.photos)) {\n      if (v && v.token) return v.token;\n    }\n  }\n\n  // Ð¸Ð½Ð¾Ð³Ð´Ð° Ð±Ñ‹Ð²Ð°ÐµÑ‚ it.json.payload.token\n  if (it.json.payload?.token) return it.json.payload.token;\n\n  return null;\n}\n\nconst attachments = [];\n\nfor (const it of items) {\n  const type = getUploadType(it) || 'image';\n  const token = extractToken(it);\n  if (!token) continue;\n\n  attachments.push({\n    type,               // image | video | audio\n    payload: { token },\n  });\n}\n\nreturn [{\n  json: {\n    text: \"ÐžÑ‚Ñ‡Ñ‘Ñ‚ Ð·Ð° Ð´ÐµÐ½ÑŒ ðŸ“¦\",\n    format: \"markdown\",\n    notify: true,\n    attachments,\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1024,720],"id":"b0b3a8cd-f4a8-41af-8089-60462a721794","name":"Code in JavaScript3"}],"connections":{"When clicking â€˜Execute workflowâ€™":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Ð£Ð·ÐµÐ» A1":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Ð£Ð·ÐµÐ» C1":{"main":[[{"node":"Code in JavaScript1","type":"main","index":0}]]},"Ð£Ð·ÐµÐ» B1":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Merge1":{"main":[[{"node":"Ð£Ð·ÐµÐ» C1","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Ð£Ð·ÐµÐ» A1","type":"main","index":0},{"node":"Ð£Ð·ÐµÐ» B1","type":"main","index":0}]]},"Code in JavaScript1":{"main":[[{"node":"Send Message1","type":"main","index":0}]]},"Ð£Ð·ÐµÐ» A":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Ð£Ð·ÐµÐ» C":{"main":[[{"node":"Code in JavaScript3","type":"main","index":0}]]},"Ð£Ð·ÐµÐ» B":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Ð£Ð·ÐµÐ» C","type":"main","index":0}]]},"Code in JavaScript2":{"main":[[{"node":"Ð£Ð·ÐµÐ» A","type":"main","index":0},{"node":"Ð£Ð·ÐµÐ» B","type":"main","index":0}]]},"Code in JavaScript3":{"main":[[{"node":"Send Message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":null,"pinData":{},"versionId":"acd1e8a1-f6ce-458b-8fff-ae3b93df39f9","activeVersionId":null,"versionCounter":6,"triggerCount":0,"tags":[],"shared":[{"updatedAt":"2026-02-11T07:00:51.299Z","createdAt":"2026-02-11T07:00:51.299Z","role":"workflow:owner","workflowId":"ch28aD9cVPTAMGNd","projectId":"pN1dQC2QTiUB8OxN","project":{"updatedAt":"2026-01-03T09:50:23.589Z","createdAt":"2026-01-02T11:57:57.457Z","id":"pN1dQC2QTiUB8OxN","name":"Ilya Sukharev <retail.sukharev@yandex.ru>","type":"personal","icon":null,"description":null,"creatorId":"a8327288-747a-47c3-9f5f-b2070eff6d8c"}}]}